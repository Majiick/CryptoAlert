DROP TABLE PRICE_POINT_ALERT;
DROP TABLE EMAIL_NOTIFICATION;
DROP TABLE ALERT;
DROP TABLE REGISTERED_USER;

CREATE TABLE IF NOT EXISTS REGISTERED_USER(
  user_pk SERIAL PRIMARY KEY,
  user_name VARCHAR(100) NOT NULL UNIQUE,
  password VARCHAR(100) NOT NULL,
  email VARCHAR(100) NOT NULL UNIQUE
);

CREATE TABLE IF NOT EXISTS ALERT(
  alert_pk SERIAL PRIMARY KEY,
  created_by_user INTEGER REFERENCES REGISTERED_USER(user_pk),
  fulfilled BOOL NOT NULL,
  repeat BOOL NOT NULL
);

CREATE TABLE IF NOT EXISTS EMAIL_NOTIFICATION(
  registered_user INTEGER REFERENCES REGISTERED_USER(user_pk),
  alert INTEGER REFERENCES ALERT(alert_pk),
  PRIMARY KEY(registered_user, alert)
);

CREATE TABLE IF NOT EXISTS PRICE_POINT_ALERT(
  exchange VARCHAR(100) NOT NULL,
  pair VARCHAR(20) NOT NULL,
  point REAL NOT NULL,
  direction VARCHAR(20) NOT NULL CHECK (direction IN ('up', 'down'))
) INHERITS(ALERT);